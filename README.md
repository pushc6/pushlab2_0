# AlmaLinux 10 on vSphere â€” IaC Project

This repo manages a full image lifecycle with IaC:

- packer/: builds the minimal AlmaLinux 10 template in vSphere
- terraform/: clones a VM from the template, adds optional data disk, mounts it
- ansible/: configuration management and bootstrap tasks

## Layout

- packer/
  - alma-template.pkr.hcl
  - http/ (kickstarts)
  - scripts/ (build/cleanup/validate)
  - cloud-init/ (optional)
- terraform/
  - main.tf, variables.tf, outputs.tf, terraform.tfvars
- ansible/
  - inventory.ini, site.yml

## Typical flow

1) Build/update the vSphere template with Packer

```
cd packer
packer init .

# Provide secrets via var-file (not committed)
# Example packer/secrets.pkrvars.hcl:
# vcenter_server    = "<your vcenter>"
# vcenter_username  = "<user>@vsphere.local"
# vcenter_password  = "<password>"
# ssh_public_key    = "ssh-ed25519 AAAA..."

packer build -var-file=secrets.pkrvars.hcl alma-template.pkr.hcl
```

2) Deploy a VM with Terraform

```
cd ../terraform/envs/prod
terraform init -upgrade
terraform apply -var-file=prod.tfvars
```

3) Configure with Ansible

```
cd ../../ansible

# Terraform generates these for you:
# - inventories/prod/hosts.yml (with group 'almalinux')
# - ssh_key (0600) for SSH

ansible-playbook update_rhel.yml -e ansible_ssh_private_key_file=ssh_key
```

Notes
- Template is intentionally minimal: open-vm-tools, openssh-server, curl.
- Terraform avoids guest customization; uses DHCP.
- Packer vSphere 8 guest type uses rhel9_64Guest for AlmaLinux 10.
- Ansible inventory and SSH key can be generated by Terraform after apply.
- Ansible can optionally install sudo/python and any app stack as needed.
